/*! ld30_game 2014-08-24 */
function Item(a,b,c){this._type=a,this._x=b,this._y=c,this._name="Test "+a+" Object",this._sprite=null,this._properties={}}function Map(a){this._data=a}function NPC(a,b,c){this._type=a,this._x=b,this._y=c,this._name="Test "+a+" NPC",this._sprite=null}function Player(a,b){this._username=a,this._password=b,this._created=(new Date).getTime(),this._socket=!1,this._zone="login",this._world="login",this._pos=[0,0],this._health=100,this._vel=[0,0],this._anim="standing",this._bag=[],this._equip={},this._model=!1,playerCount++}function SimplexNoise(a){"undefined"==typeof a&&(a=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var b=0;256>b;b++)this.p[b]=Math.floor(256*a.random());this.perm=[];for(var c=0;512>c;c++)this.perm[c]=this.p[255&c];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}function World(a,b){this._model=!1,this._name="Test World",this._seed="Test World",this._size=a,this._width=a,this._height=b,this._id_player=null,this._is_primary=!1,this._npcs=[],this._mapData=[],this._mapObjects=[],this._items=[],this._current_players=1,this._player_list={},this._map=null,this._spawnPoint=[0,0],this._biome=cnf.BIOME_GRASS,"undefined"==typeof module&&(this._map=new Map)}function showAlert(a){$("#alert_modal div.msg").html(a),$("#alert_modal").modal("show")}"undefined"!=typeof module&&(module.exports=Item),"undefined"!=typeof module&&(module.exports=Map),"undefined"!=typeof module&&(module.exports=NPC);var playerCount=0;if(Player.prototype.playerCount=function(){return playerCount},Player.prototype.login=function(a){return a!=this._password?!1:!0},Player.prototype.setSocket=function(a){this._socket=a},Player.prototype.getProfile=function(){return{username:this._username,health:this._health,vel:this._vel,bag:this._bag,equip:this._equip,zone:this._zone,pos:this._pos,created:this._created}},Player.prototype.setProfile=function(a){this._username=a.username,this._health=a.health,this._vel=a.vel,this._equip=a.equip,this._zone=a.zone,this._pos=a.pos,this._created=a.created,this._world=a.world},Player.prototype.updateDisplay=function(){console.log("display for ",this),$("#info_username").html(this._username),$("#info_zone").html(this._zone+" ["+this._pos[0]+","+this._pos[1]+"]"),$("#info_health").html(this._health)},Player.prototype.sendPing=function(){this._startPing=(new Date).getTime(),this._socket.emit("ping",{})},Player.prototype.receivePing=function(){this._endPing=(new Date).getTime(),this._latency=this._endPing-this._startPing,this._socket&&this._socket.emit("info",{latency:this._latency})},"undefined"!=typeof module&&(module.exports=Player),SimplexNoise.prototype.dot=function(a,b,c){return a[0]*b+a[1]*c},SimplexNoise.prototype.noise=function(a,b){var c,d,e,f,g,h=.5*(Math.sqrt(3)-1),i=(a+b)*h,j=Math.floor(a+i),k=Math.floor(b+i),l=(3-Math.sqrt(3))/6,m=(j+k)*l,n=j-m,o=k-m,p=a-n,q=b-o;p>q?(f=1,g=0):(f=0,g=1);var r=p-f+l,s=q-g+l,t=p-1+2*l,u=q-1+2*l,v=255&j,w=255&k,x=this.perm[v+this.perm[w]]%12,y=this.perm[v+f+this.perm[w+g]]%12,z=this.perm[v+1+this.perm[w+1]]%12,A=.5-p*p-q*q;0>A?c=0:(A*=A,c=A*A*this.dot(this.grad3[x],p,q));var B=.5-r*r-s*s;0>B?d=0:(B*=B,d=B*B*this.dot(this.grad3[y],r,s));var C=.5-t*t-u*u;return 0>C?e=0:(C*=C,e=C*C*this.dot(this.grad3[z],t,u)),70*(c+d+e)},SimplexNoise.prototype.noise3d=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n=1/3,o=(a+b+c)*n,p=Math.floor(a+o),q=Math.floor(b+o),r=Math.floor(c+o),s=1/6,t=(p+q+r)*s,u=p-t,v=q-t,w=r-t,x=a-u,y=b-v,z=c-w;x>=y?y>=z?(h=1,i=0,j=0,k=1,l=1,m=0):x>=z?(h=1,i=0,j=0,k=1,l=0,m=1):(h=0,i=0,j=1,k=1,l=0,m=1):z>y?(h=0,i=0,j=1,k=0,l=1,m=1):z>x?(h=0,i=1,j=0,k=0,l=1,m=1):(h=0,i=1,j=0,k=1,l=1,m=0);var A=x-h+s,B=y-i+s,C=z-j+s,D=x-k+2*s,E=y-l+2*s,F=z-m+2*s,G=x-1+3*s,H=y-1+3*s,I=z-1+3*s,J=255&p,K=255&q,L=255&r,M=this.perm[J+this.perm[K+this.perm[L]]]%12,N=this.perm[J+h+this.perm[K+i+this.perm[L+j]]]%12,O=this.perm[J+k+this.perm[K+l+this.perm[L+m]]]%12,P=this.perm[J+1+this.perm[K+1+this.perm[L+1]]]%12,Q=.6-x*x-y*y-z*z;0>Q?d=0:(Q*=Q,d=Q*Q*this.dot(this.grad3[M],x,y,z));var R=.6-A*A-B*B-C*C;0>R?e=0:(R*=R,e=R*R*this.dot(this.grad3[N],A,B,C));var S=.6-D*D-E*E-F*F;0>S?f=0:(S*=S,f=S*S*this.dot(this.grad3[O],D,E,F));var T=.6-G*G-H*H-I*I;return 0>T?g=0:(T*=T,g=T*T*this.dot(this.grad3[P],G,H,I)),32*(d+e+f+g)},"undefined"!=typeof module&&(module.exports=SimplexNoise),"undefined"!=typeof module)var cnf=require("./cnf");if("undefined"!=typeof module)var SimplexNoise=require("./SimplexNoise");if("undefined"!=typeof module)var NPC=require("./NPC");World.prototype.generate=function(a,b,c){this._name=a?a:b._name+"'s World",this._seed=this._name,console.log("Generating world "+this._name+" ["+this._biome+"] size "+this._size+" for "+b._username+" : "+typeof c);var d=new SimplexNoise,e=6,f=[3,4,5],g=[0,1,2],h=[7],i=[6];this._biome==cnf.BIOME_SNOW?(f=[9,10,11],g=[12]):this._biome==cnf.BIOME_DESERT||this._biome==cnf.BIOME_CITY,this.occupiedTiles={};for(var j=!1,k=0;k<this._width;k++){this._mapData[k]=[];for(var l=0;l<this._height;l++){var m=0,n=(d.noise(k/this._width*e/2,l/this._height*e/2)+1)/2,o=0;switch(this._biome){case cnf.BIOME_GRASS:n>.9?(m=h[0],o=1):n>.65?(m=Math.floor((n-.65)/.35*g.length),m=g[m],o=1):.05>n&&(m=i[0],o=1);break;case cnf.BIOME_DESERT:break;case cnf.BIOME_SNOW:n>.9?(m=g[0],o=1):n>.52&&.6>n?(m=13,o=1):n>=.6&&.67>=n&&(m=14,o=1);break;case cnf.BIOME_FOREST:break;case cnf.BIOME_CITY:}if(o||(n=(d.noise(k/this._width*e,l/this._height*e)+1)/2,m=Math.floor(n*f.length),m=f[m]),cnf.tiles[m]||(m=0),this._mapData[k][l]=m,k>3&&l>3&&cnf.tiles[m].passable&&b&&!j)j=!0,b._pos=[k,l];else if(cnf.tiles[m].passable){if(n=Math.random(),n>.92){n=Math.random();var p=0;p=n>.8?2:n>.6?4:5,this._mapObjects.push({x:k,y:l,i:p,tile_i:cnf.blocks[p].tile_i}),cnf.blocks[p].passable||(this.occupiedTiles[k+","+l]=1)}}else this.occupiedTiles[k+","+l]=1}}console.log("map generated, populating with npcs");for(var q=25*Math.random()+10,r=0;q>r;r++){for(var s=Math.floor(Math.random()*cnf.NPC_TYPE_LIST.length),t=!1,u=0;20>u&&!t;){var v=Math.floor(Math.random()*this._width),w=Math.floor(Math.random()*this._height);if(!this.occupiedTiles[v+","+w]){t=[v,w];break}u++}var x=new NPC(cnf.NPC_TYPE_LIST[s],t[0],t[1]);this._npcs.push(x)}c&&c()},"undefined"!=typeof module&&(module.exports=World);var cnf={title:"Ludum Dare 30",ws_server:"http://10.0.33.34:8001",WORLD_SIZE_PLAYER:100,WORLD_SIZE_MAX:140,WORLD_SIZE_MIN:40,BIOME_GRASS:0,BIOME_SNOW:1,BIOME_DESERT:2,BIOME_CITY:3,BIOME_FOREST:4,TILES_MAX:4,TILE_TREE:0,TILE_GRASS:1,TILE_WATER:2,TILE_ROAD:3,tiles:[{i:0,name:"tree",passable:!0,tile_i:7},{i:0,name:"tree1",passable:!0,tile_i:8},{i:0,name:"tree2",passable:!0,tile_i:9},{i:1,name:"grass",passable:!0,tile_i:0},{i:2,name:"grass1",passable:!0,tile_i:1},{i:3,name:"grass2",passable:!0,tile_i:2},{i:0,name:"dirt",passable:!0,tile_i:38},{i:4,name:"water",passable:!1,tile_i:170},{i:5,name:"road",passable:!0,tile_i:78},{name:"snow",passable:!0,tile_i:45},{name:"snow1",passable:!0,tile_i:46},{name:"snow2",passable:!0,tile_i:47},{name:"snow_tree",passable:!1,tile_i:49},{name:"snow_ice_hole",passable:!0,tile_i:55},{name:"snow_ice",passable:!0,tile_i:60}],blocks:[{name:"stairs",passable:!0,interactable:!0,destructable:!1,tile_i:230},{name:"stairs1",passable:!0,interactable:!0,destructable:!1,tile_i:232},{name:"trap_arrow",passable:!0,interactable:!0,destructable:!0,tile_i:234},{name:"door_open",passable:!0,interactable:!0,destructable:!0,tile_i:236},{name:"campfire",passable:!0,interactable:!0,destructable:!0,tile_i:238},{name:"rock",passable:!1,interactable:!1,destructable:!0,tile_i:568}]};cnf.NPC_ATLAS={frames:{npcguy:{frame:{x:48,y:0,w:48,h:48},rotated:!1,trimmed:!1},npcguy2:{frame:{x:96,y:0,w:48,h:48},rotated:!1,trimmed:!1},npcguy3:{frame:{x:144,y:0,w:48,h:48},rotated:!1,trimmed:!1},npcgirl:{frame:{x:192,y:0,w:48,h:48},rotated:!1,trimmed:!1},npcgirl2:{frame:{x:48,y:48,w:48,h:48},rotated:!1,trimmed:!1}}},cnf.NPC_TYPES={},cnf.NPC_TYPE_LIST=[];for(var title in cnf.NPC_ATLAS.frames)cnf.NPC_TYPES[title]=cnf.NPC_ATLAS.frames[title],cnf.NPC_TYPE_LIST.push(title);cnf.TILES_MAX=cnf.tiles.length,"undefined"!=typeof module&&(module.exports=cnf),CreateGame=function(a){return this._canvasID=a,this._canvasE=document.getElementById(a),this._socket=!1,this._connected=!1,this._authenticated=!1,this._zone=!1,this._world=!1,this._player=!1,this._primary_world=!1,this._canvasE?(this._canvasW=$(this._canvasE).width(),this._canvasH=$(this._canvasE).height(),this._canvasH||(this._canvasH=500),this.init=function(){this._p=new Phaser.Game(this._canvasW,this._canvasH,Phaser.CANVAS,this._canvasID,{preload:this.preload,create:this.create,update:this.update,render:this.render}),this._socket=io(cnf.ws_server);var a=this;$("#info_server").html("Connecting.."),$("#frm_msg").on("submit",function(){return console.log("form submitted! ",a.send_msg),a.send_msg(),!1}),$("#frm_warp").on("submit",function(){var b=$("#warp_id").val();if(b&&!(b.length<10))return a._socket.emit("warp",b),showAlert("Requesting warp"),!1}),this._socket.on("connect",function(){$("#info_server").html("Connected"),hideSpinner(),a._connected=!0,a._world?(console.log("attempting to login automatically"),a._login_params.id_world=a._world._model._id,a._socket.emit("login",a._login_params),showSpinner("Reconnecting..")):$("#login_modal").modal("show"),console.log("socket connect")}),this._socket.on("connect_error",function(){$("#info_server").html("Connect Failed"),showSpinner("Server Disconnected"),a.playable=!1,a._connected=!1,a._socket.disconnect()}),this._socket.on("disconnect",function(){$("#info_server").html("Disconnected"),showSpinner("Server Disconnected")}),this._socket.on("alert",function(a){console.log("alert",a),showAlert(a)}),this._socket.on("pc",function(b){b.name!=a._player._username&&(console.log("pc",b),a._world._player_list[b.name]&&b.pos&&a.movePlayerTo(pos[0],pos[1],a._world._player_list[b.name]))}),this._socket.on("pc list",function(b){console.log("pc list",b);for(var c in b)if(b[c].name!=a._player._username){var d={font:"12px Arial",fill:"#ff0044",align:"center"},e=new Player(b[c].name,"");e._pos=b[c].pos,e.sprite=a._p.add.sprite(10,10,"chr1"),e.sprite.animations.add("walk",[0,1,2,3]),e.sprite.animations.add("stand",[0]),e.sprite.animations.play("stand",0),e.sprite.animations.add("walk_left",[4,5,6,7]),e.sprite.animations.add("walk_right",[8,9,10,11]),e.sprite.animations.add("walk_up",[12,13,14,15]),e.sprite.anchor.setTo(.5,.5),e.sprite.z=10,e.curTile=a.map.getTile(e._pos[0],e._pos[1],"world"),e.sprite.x=e.curTile.worldX+e.sprite.width/2,e.sprite.y=e.curTile.worldY+e.sprite.height/4,e.label=a._p.add.text(e.sprite.x,e.curTile.worldY-30,e._username,d),e.sprite.bringToTop(),e.label.bringToTop(),a._world._player_list[b[c].name]=e}}),this._socket.on("pc join",function(b){if(b.name!=a._player._username){console.log("pc join",b);var c=new Player(b.name,"");c._pos=b.pos,c.sprite=a._p.add.sprite(10,10,"chr1"),c.sprite.animations.add("walk",[0,1,2,3]),c.sprite.animations.add("stand",[0]),c.sprite.animations.play("stand",0),c.sprite.animations.add("walk_left",[4,5,6,7]),c.sprite.animations.add("walk_right",[8,9,10,11]),c.sprite.animations.add("walk_up",[12,13,14,15]),c.sprite.anchor.setTo(.5,.5),c.sprite.z=10,c.curTile=a.map.getTile(c._pos[0],c._pos[1],"world"),c.sprite.x=c.curTile.worldX+c.sprite.width/2,c.sprite.y=c.curTile.worldY+c.sprite.height/4,c.label=a._p.add.text(c.sprite.x,c.curTile.worldY-30,c._username,pStyle),c.sprite.bringToTop(),c.label.bringToTop(),a._world._player_list[b.name]=c,console.log(a._world._player_list)}}),this._socket.on("pc leave",function(b){a._player._username!=b.name&&(console.log("pc leave",b),a._world._player_list[b.name]&&(a._world._player_list[b.name].sprite&&a._world._player_list[b.name].sprite.destroy(!0),delete a._world._player_list[b.name]))}),this._socket.on("login",function(b){console.log("login response",b),processingLogin=!1,$("#login_modal").css("display","none"),$("div.modal-backdrop").css("display","none"),b.status?($("#info_server").html("Logged In"),a._player||a._world?(hideSpinner(),a.playable=!0):(a._player=new Player(a._login_params.user,a._login_params.pwd),a._player.setProfile(b.profile),a._player.updateDisplay(),$("div.right").slideDown(),a._player.updateDisplay(),showSpinner("Loading "+a._player._zone))):(showAlert(b.err),hideSpinner())}),this._socket.on("world",function(b,c){"string"==typeof b&&(b=JSON.parse(b)),a.playable=!1,showSpinner("Loading world: "+b._name),console.log("Received world data from server!",b,c),a._world=b,a._player._world=b,b._is_primary&&!a._primary_world&&(a._primary_world={id:b._model._id,name:b._name,pos:c}),$("#info_zone").html(b._name),$("#info_zone_id").html(b._model._id),$("#login_modal").modal("hide"),a.loadWorld(c)}),this._socket.on("chat message",function(b){a.received_msg(b.user,b.msg)}),this._socket.on("player login",function(b){a.received_msg("System",b+" has logged in")}),this._socket.on("ping",function(){a._socket.emit("ping")}),this._socket.on("info",function(b){"undefined"!=typeof b.latency&&$("#info_latency").html(b.latency+"ms"),"undefined"!=typeof b.position&&($("#info_position").html("x:"+b.position[0]+" y:"+b.position[1]),a.movePlayerTo(b.position[0],b.position[1])),"undefined"!=typeof b.zone&&$("#info_zone").html(b.zone)})},this.received_msg=function(a,b){console.log("received chat",b);var c='<li style="float:left; width:100%;"><div style="float:left;max-width: 80px; font-weight: bold; margin-right: 5px; overflow-x:hidden;">';c+=a+"</div><div style='float:left;max-width:120px;overflow-x:wrap;'>"+b+"</div></li>",$("#chat_messages").append(c),$("#chat_div").scrollTop($("#chat_messages").height())},this.send_msg=function(){var a=$("#msg").val();!a||a.length<2||self._socket&&self._connected&&(console.log("sending msg",a),self._socket.emit("chat message",a))},this.preload=function(){console.log("Preloading .. "),self._p.load.image("tileset_map","assets/elona/map1tp.png"),self._p.load.spritesheet("chr1","assets/elona/char1.png",32,48),self._p.load.atlasJSONHash("npcs","assets/elona/npcs.png",null,cnf.NPC_ATLAS)},this.create=function(){console.log("Game created .. "),self.map=self._p.add.tilemap(),self.map.addTilesetImage("tileset_map","tileset_map",48,48),self.layer=self.map.create("Intro",20,20,48,48),self.layer.resizeWorld(),self.npcguy=self._p.add.sprite(200,200,"npcs","npcguy"),self.sprite=self._p.add.sprite(10,10,"chr1"),self.sprite.animations.add("walk",[0,1,2,3]),self.sprite.animations.add("stand",[0]),self.sprite.animations.play("stand",0),self.sprite.animations.add("walk_left",[4,5,6,7]),self.sprite.animations.add("walk_right",[8,9,10,11]),self.sprite.animations.add("walk_up",[12,13,14,15]),self.sprite.anchor.setTo(.5,.5),self.sprite.z=10,console.log("sprite created",self.sprite),self.cursors=self._p.input.keyboard.createCursorKeys(),self.cursors.left.onDown.add(self.left),self.cursors.up.onDown.add(self.up),self.cursors.down.onDown.add(self.down),self.cursors.right.onDown.add(self.right),self.playable=!0,self.layer.debug=!0,self.map.fill(0,0,0,20,20,self.map.currentLayer),self._p.camera.follow(self.sprite)},this.update=function(){},this.up=function(){if(self.playable){var a=self.map.getTileAbove(0,self.curTile.x,self.curTile.y),b=!1;a&&(b=self.movePlayerTo(a.x,a.y)),b&&self.sprite.animations.play("walk_up",3)}},this.down=function(){if(self.playable){var a=self.map.getTileBelow(0,self.curTile.x,self.curTile.y),b=!1;a&&(b=self.movePlayerTo(a.x,a.y)),b&&self.sprite.animations.play("walk",3)}},this.left=function(){if(console.log("left!"),self.playable){var a=self.map.getTileLeft(0,self.curTile.x,self.curTile.y),b=!1;a&&(b=self.movePlayerTo(a.x,a.y)),b&&self.sprite.animations.play("walk_left",3)}},this.right=function(){if(self.playable){var a=self.map.getTileRight(0,self.curTile.x,self.curTile.y),b=!1;a&&(b=self.movePlayerTo(a.x,a.y)),b&&self.sprite.animations.play("walk_right",3)}},this.render=function(){self._p.debug.text("Current Layer: "+self.map.layers[self.map.currentLayer].name,16,550)},this.loadWorld=function(a){showAlert("World data received - creating display"),console.log("world data recieived - creating display"),$("#info_zone").html(self._world._name);var b=self.map.getLayer("world");wl=self.map.create("world",self._world._mapData.length,self._world._mapData[0].length,48,48),self._worldlayer=wl,b=self.map.getLayer("world"),wl.resizeWorld();for(var c=null,d=0;d<self._world._mapData.length;d++)for(var e=0;e<self._world._mapData[d].length;e++)c=self.map.putTile(cnf.tiles[self._world._mapData[d][e]].tile_i,d,e,"world"),c.properties.i=self._world._mapData[d][e],c.properties.passable=cnf.tiles[self._world._mapData[d][e]].passable;console.log("Creating "+self._world._mapObjects.length+" blocks");var f=self.map.createBlankLayer("blocks",self._world._mapData.length,self._world._mapData[0].length,48,48);self._blocklayer=f;for(var g=0;g<self._world._mapObjects.length;g++)c=self.map.putTile(self._world._mapObjects[g].tile_i,self._world._mapObjects[g].x,self._world._mapObjects[g].y,"blocks"),c.properties.i=self._world._mapObjects[g].i,cnf.blocks[self._world._mapObjects[g].i]?(c.properties.passable=cnf.blocks[self._world._mapObjects[g].i].passable,c.properties.interactable=cnf.blocks[self._world._mapObjects[g].i].interactable):console.log("invalid block",self._world._mapObjects[g]);for(console.log("map layer set"),g=0;g<self._world._npcs.length;g++){var h=self.map.getTile(self._world._npcs[g]._x,self._world._npcs[g]._y,"world");self._world._npcs[g].curTile=h,self._world._npcs[g].sprite=self._p.add.sprite(h.worldX,h.worldY,"npcs",self._world._npcs[g]._type),self._world._npcs[g].sprite.anchor.setTo(.5,.5),self._world._npcs[g].sprite.y+=self._world._npcs[g].sprite.height/4,self._world._npcs[g].sprite.x+=self._world._npcs[g].sprite.width/2}var i=Math.floor(self._world._width/2);a?self.movePlayerTo(a[0],a[1]):self.movePlayerTo(i,Math.floor(self._world._height/2)),self.playable=!0,self._p.camera.follow(self.sprite),self.sprite.bringToTop(),hideSpinner(),$("#login_modal").modal("hide"),console.log("loadWorld Finished"),setTimeout(function(){self._player._pos||(self._player._pos=[10,10],self.curTile=self.map.getTile(10,10,"world"),self.sprite.x=self.curTile.worldX+self.sprite.width/2,self.sprite.y=self.curTile.worldY+self.sprite.height/4),self.sprite.bringToTop()},100)},this.movePlayerTo=function(a,b,c){var d=self.map.getTile(a,b,"world"),e=self.map.getTile(a,b,"blocks");return e&&!e.properties.passable?!1:(console.log(d),d.properties.passable===!1?!1:($("#info_position").html(a+" , "+b),c?(c._pos=[a,b],c.curTile=d,c.sprite&&(c.sprite.x=d.worldX+c.sprite.width/2,c.sprite.y=d.worldY+c.sprite.height/4,c.sprite.bringToTop()),c.label&&(c.label.x=d.worldX+c.sprite.width/2,c.label.y=d.worldY-20),!0):(self._player._pos=[a,b],self.curTile=d,self.sprite.x=d.worldX+self.sprite.width/2,self.sprite.y=d.worldY+self.sprite.height/4,self.sprite.bringToTop(),self._socket.emit("move",[a,b]),!0)))},this.doLogin=function(a){return self._connected?(showSpinner("Logging In.."),self._login_params=a,void self._socket.emit("login",a)):void console.log("Cant login not connected")},self):(alert("Missing canvas!"),!1)},console.log("ld30 game loaded - yay");